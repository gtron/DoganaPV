#if( $iva && $json)
#parse('registri/json/iva.json_vm')
#elseif($json)
#parse('registri/json/doganale.json_vm')
#else
#if( $iva )
#set($activeMenu='IVA')
#else 
#set($activeMenu='DOGANALE')
#end
#parse('costanti.vm')
#* 
#set( $addJs = ['/js/jquery.tablefilter/daemachTools-packed.js','/js/jquery.tablefilter/jquery.cookies-packed.js','/js/jquery.tablefilter/jquery.tableFilter.columnStyle-packed.js','/js/jquery.tablefilter/jquery.tableFilter.js','/js/jquery.tablefilter/jquery.truemouseout-packed.js','/js/jquery.tablefilter/jquery-packed.js','/js/jquery.tablefilter/json-packed.js','/js/jquery.tablefilter/prototypes-packed.js','/js/jquery.tablefilter/pp.js'] )
*#
#set( $addCss = ['/style/tablefilter/tableFilter.aggregator.css','/style/tablefilter/tableFilter.css','/style/grid.css','/js/jquery.ui/themes/flora/flora.dialog.css','/js/jquery.ui/themes/flora/flora.resizable.css'] )
#set( $addJs = ['/js/jquery.jqgrid/jquery.jqGrid.js','/js/jquery.ui/ui.calendar.js','/js/jquery.ui/ui.dimensions.js','/js/jquery.ui/ui.mouse.js','/js/jquery.ui/ui.draggable.js','/js/jquery.ui/ui.resizable.js','/js/jquery.ui/ui.dialog.js'])
#parse('header.vm')


<script type="text/javascript">
function initRowHighlighting(){
var table = document.getElementById('tablemovimenti');
attachRowMouseEvents(table.getElementsByTagName('tr'));
}
function attachRowMouseEvents(rows){
for(var i = 0;i < rows.length;i++){
var row = rows[i];
row.onmouseover = function(){ highlightRow(this, true);}
row.onmouseout = function() { highlightRow(this, false);}
// row.style.cursor = 'pointer';
}}

function highlightRow( row, isover) { 
if ( row.getAttribute('origClass') == null )
	row.setAttribute('origClass' , row.className) ;
	
row.className = isover ? 'hi' : row.getAttribute('origClass');
}


$('document').ready( function() {

$("#dlg_Prepara").dialog({ width:400,
height:120,buttons:{Stampa: function(){preparaPagine();} ,Annulla : function() { $("#dlg_Prepara").dialogClose(); } } 
});
$("#dlg_Prepara").dialogClose();

} ) ;

function preparaPagine() {
//var w = window.open('voidreg.html','x','width=10,height=10,scrollable=no');
//w.blur();
var n = document.getElementById('numPagine').value ;
var f = document.getElementById('fromPagina').value ;

if ( n + 10 == 10 ) return false;
if ( f + 10 == 10 ) return false;

stp.printPages( 1 * n, 1 * f);;

$("#dlg_Prepara").dialogClose();
//setTimeout( function() { w.printPages(5,102); } , 1000 ) ;
}

$('document').ready( function() {

$("#dlg_Prepara").dialog({ width:400,
height:120,buttons:{Stampa: function(){preparaPagine();} ,Annulla : function() { $("#dlg_Prepara").dialogClose(); } } 
});
$("#dlg_Prepara").dialogClose();
dlg_Confirm

$("#dlg_Print").dialog({ width:400,
height:120,buttons:{Stampa: function(){stampaRegistro();} ,Annulla : function() { $("#dlg_Print").dialogClose(); } } 
});
$("#dlg_Print").dialogClose();

$("#dlg_Confirm").dialog({ width:400,
height:120,buttons:{Si: function(){confirmedStampa();} , No : function() { $("#dlg_Confirm").dialogClose(); } } 
});
$("#dlg_Confirm").dialogClose();

jQuery("#tablemovimenti").jqGrid(
{ 
#if($iva)#set($regiva='iva=true&')#end
url:'.registri?$!{regiva}json=true&records=$!records&idMerce='+ '' + '&inputNum= ' + $("#inputNum").val() + '&inputDal=' + $("#inputDal").val() + '&inputAl=' + $("#inputAl").val() + '&ndS='+new Date().getTime(),
datatype: 'json', 
height: 350, 
colNames:['N.','Cons.','Part.' ,'Data', 'Documento', 'Merce','umido<br />IN','umido<br />OUT','secco<BR >IN','secco<BR />OUT'
	#if($iva) ,'&euro;','$'#end ],
colModel:[
{name:'numero',index:'numregistro',width:40,align:'center'},
{name:'consegna',index:'C.numero',width:60,align:'center'},
{name:'n_partitario',index:'C.numpartitario',width:40,align:'center'},
{name:'data',index:'data',width:80,align:'center'},
{name:'documento',index:'documento',width:80, sortable:false},
{name:'merce',index:'M.nome',width:120},
{name:'umido_in',index:'umido',width:60,sortable:false},
{name:'umido_out',index:'umido',width:60,sortable:false},
{name:'secco_in',index:'secco',width:60,sortable:false}, 
{name:'secco_out',index:'secco',width:60,sortable:false}
#if($iva)
,{name:'val_euro',index:'valoreeuro',width:60,sortable:false},
{name:'val_dollari',index:'valoreeuro',width:60,sortable:false}
#end
],
width:890,
rowNum:100, 
rowList:[10,25,50], 
loadtext:'Caricamento dati...',
imgpath: 'images', 
pager: jQuery('#pager')
});
} 
   
);


function doSearch(){ 
	var numero = jQuery("#inputNum").val(); 
	var dal = jQuery("#inputDal").val();
	var al = jQuery("#inputAl").val();
	var consegne = jQuery("#consegne").val();
	var idmerce = jQuery("#idmerce").val();
	
	jQuery("#tablemovimenti").setUrl(".registri?$!regiva&json=true&consegna=" + consegne + "&inputNum=" + numero + "&inputDal=" + dal + "&inputAl=" + al + '&idMerce='+ idmerce ); 
	
	jQuery("#tablemovimenti").setPage(1);
	jQuery("#tablemovimenti").trigger("reloadGrid"); 
	return false;
}

var from = 0, to = 0;

function printIFrame(f, t) {
stp.print();
from = f ; to = t ;
// $('#dlg_Confirm').dialogOpen();
}
function confirmedStampa() {
location.href='.main?f=' + from + '&t=' + to ;
}
function stampaRegistro() {
var numpag = document.getElementById('numPaginePrint').value;
var from = document.getElementById('fromMovimento').value;
stp.location.href='.registri?iva=true&cmd=stampa&from=' + from + '&num=' + numpag ;
$('#dlg_Print').dialogClose();
}
</script> 


<iframe name="stp" src="voidreg.html" width="10" height="10" style="visibility:hidden;position:absolute;"></iframe>

#set($dateFormat = 'dd/MM/yy')
##
#if($iva)
#parse('registri/inner_iva.vm')
#else 
#parse('registri/inner_doganale.vm')
#end
<div align="center"><input type="button" value="Applica Filtri" onclick="return doSearch();"></div>


<div class="commands">
<ul>
<li><a href="#" onclick="$('#dlg_Prepara').dialogOpen(); return false;"><img src="$!images/action-ico-registra.png" />Prepara Pagine</a></li>
<li><a href="#" onclick="$('#dlg_Print').dialogOpen(); return false;"><img src="$!images/action-ico-registra.png" />Stampa Registro</a></li>
</ul>
</div>

<div id="dlg_Prepara" class="flora" style="text-align:center;">
Prepara <input type="text" id="numPagine" value="10" size="3" />pagine a partire dal numero  <input type="text" id="fromPagina" value="" size="3"  /> 
</div>
<div id="dlg_Print" class="flora" style="text-align:center;">
Stampa registro
<span style="display:none;">
Stampa <input type="text" id="numPaginePrint" value="10" size="3" /> pagine <br />
a partire dal movimento numero <input type="text" id="fromMovimento" value="" size="3"  /> </span>
</div>
<div id="dlg_Confirm" class="flora" style="text-align:center;">
La stampa è stata completata correttamente ?
</div>
#parse('footer.vm')
#end

