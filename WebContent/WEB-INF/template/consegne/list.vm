#set($activeMenu='PARTITARI')
#set( $addJs = ['/js/jquery.ui/ui.calendar.js','/js/jquery.ui/ui.dimensions.js','/js/jquery.ui/ui.mouse.js','/js/jquery.ui/ui.draggable.js','/js/jquery.ui/ui.draggable.ext.js','/js/jquery.ui/ui.resizable.js','/js/jquery.ui/ui.dialog.js','/js/jquery.tablefilter/jquery.cookies-packed.js','/js/jquery.tablefilter/prototypes-packed.js','/js/jquery.tablefilter/json-packed.js','/js/jquery.tablefilter/jquery.truemouseout-packed.js','/js/jquery.tablefilter/daemachTools-packed.js','/js/jquery.tablefilter/jquery.tableFilter.js','/js/jquery.tablefilter/jquery.tableFilter.columnStyle-packed.js','/js/jquery.tablefilter/pp.js'] )
#set( $addCss = ['/js/jquery.ui/themes/flora/flora.all.css','/style/tablefilter/tableFilter.aggregator.css','/style/tablefilter/tableFilter.css'] )
#parse('costanti.vm')
#parse('header.vm')
<div class="print" id="ret"></div>
<div class="view">
<link rel="stylesheet" type="text/css" href="$wwwRoot/style/registro.css" media="print" />
<h2>
Elenco Consegne #if($chiuse)Chiuse#else Attive#end 
</h2>

<style type="text/css">
TH {
	background-color: #BCBCBC;
}
TBODY TR TD { border-top : 2px solid #AAA ;
}

TBODY TR:hover {
	background-color: #FFC;
}
TD { text-align: center; }

TFOOT TD { 
border-top : 2px solid #AAA ;
}
## .offColor { background-color : #EFEFEF; }
 
</style>

<ul class="commands">
<li><a href="#" onclick="stampaCopertina(); return false;"><img src="$!images/action-ico-stampa.png" />Copertina</a></li>
<li><a href="#" onclick="$('#dlg_Prepara').dialogOpen(); return false;"><img src="$!images/action-ico-stampa.png" />Prepara Pagine</a></li>
<li><a href=".consegne?cmd=edit"><img src="$!images/action-ico-nuovo.png" /> Nuova consegna</a></li>

</ul>

<table border="0" width="100%" cellspacing="0" cellpadding="1" id="consegne">
<thead><tr class="header">
<th>Partitario</th>
<th>Numero</th>
<th>Merce</th>
<th>Mezzo</th>
<th>Stato</th>
<th>Iter</th>
<th>&nbsp;</th>
</tr></thead>
<tbody>
#foreach( $c in $list ) 
<tr>
<td align="center"><a href="?id=$c.Id">$c.NumeroPartitario</a></td>
<td align="center"><a href="?id=$c.Id">$c.Numero</a></td>
<td><a href="?id=$c.Id">$c.Merce.Nome</a></td>
<td><a href="?id=$c.Id">$c.Mezzo</a></td>
<td>
#if($c.isChiusa()) Chiusa 
##<a href="?cmd=edit&r=1&id=$c.Id" onclick="return confirm('Creare una nuova consegna uguale?');">[ Duplica ]</a>
#elseif($c.isAperta()) Aperta 
##<a href="?cmd=chiudi&id=$c.Id&exec=1" onclick="return confirm('Chiudi la consegna selezionata?');">[ Chiudi ]</a>
#else Creata 
##<a href="?cmd=apri&id=$c.Id&exec=1" onclick="openDialog($c.Id,'#dlg_OpenC');return false;">[ Apri ]</a>
#end
</td>
<td>$c.Iter.Nome</td>
<td align="center">
<a href="?id=$c.Id" title="Visualizza Consegna ($c.Id)" ><img src="$!images/consegne.gif" alt="Visualizza Consegna ($c.Id)" /></a>
#if( ! $c.isChiusa() )
<a href="?id=$c.Id&cmd=edit" title="Modifica Consegna ($c.Id)" ><img src="$!images/consegne_edit.gif" alt="Modifica Consegna ($c.Id)" /></a> #end
###if($c.isAperta()) <a href="#" id="import_$c.Id" onclick="return openDialog($c.Id,'#dlg_ImportTo');"><img src="$!images/importa.gif" /></a>#end
</td>
</tr>
#end
</tbody>
</table>
<br>


<script type="text/javascript">

function preparaPagine() {
//var w = window.open('voidreg.html','x','width=10,height=10,scrollable=no');
//w.blur();
var n = document.getElementById('numPagine').value ;
var f = document.getElementById('fromPagina').value ;

if ( n + 10 == 10 ) return false;
if ( f + 10 == 10 ) return false;

// stp.printPages( 1 * n, 1 * f);
//alert( '.registri?cmd=prepara&f=' + f + '&t=' + ( 1 * f + 1 * n ) );
$('#ret').load('.registri?cmd=prepara&partitari=true&f=' + f + '&t=' + ( ( 1 * f + 1 * n ) - 1 ) , 
		{} , function() {$('#dlg_Prepara').dialogClose();window.print();});
//setTimeout( function() { w.printPages(5,102); } , 1000 ) ;
}

$('document').ready( function() {

$("#dlg_Prepara").dialog({ width:400,
height:120,buttons:{Stampa: function(){preparaPagine();} ,Annulla : function() { $("#dlg_Prepara").dialogClose(); } } 
});
$("#dlg_Prepara").dialogClose();
} ) ;

var idConsegna = -1 ;

$('document').ready( function() {


$("#consegne").eq(0).tableFilter();

} ) ;

function stampaCopertina() {
$('#ret').load('cop_part.html' ); 
setTimeout( function(){ window.print() } , 1500 );
}

</script>

<div id="dlg_Prepara" class="flora" style="text-align:center;">
Prepara <input type="text" id="numPagine" value="10" size="3" />pagine a partire dal numero  <input type="text" id="fromPagina" value="" size="3"  /> 
</div>

<div style="text-align:center;">
#if($chiuse)
<a href=".consegne?cmd=list">[Consegne Attive]</a>
#else
<a href=".consegne?cmd=list&chiuse=1">[Archivio Consegne Chiuse]</a>
#end</div>
#parse('footer.vm')
</div>