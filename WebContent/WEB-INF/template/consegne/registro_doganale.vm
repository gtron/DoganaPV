#set( $rettificaDone = true )
<table border="0" class="movimenti" cellpadding="2" cellspacing="0" id="tablemovimenti">
##<caption>Registro Doganale per la Consegna n. <strong>$obj.Numero</strong><br/>Merce : <strong>$!obj.Merce.Nome</strong><br><br /></caption>
<tr>
<th rowspan="2">Num.Registro</th>
##<th  rowspan="2" width="6%">Tipo&nbsp;&nbsp;</th>
<th rowspan="2">Data</th>
<th rowspan="2">Documento</th>
<th width="10%" colspan="2">Umido</th>
<th rowspan="2" width="20">&nbsp;</th>
<th width="10%" colspan="2">Secco</th>

##<th><input type="checkbox" onchange="selectDOG(this);" /></th>
</tr>
<tr>
<th>Entrata</th>
<th>Uscita</th>
<th>Entrata</th>
<th>Uscita</th>
</tr>
<tbody>
#set($dateFormat = 'dd/MM/yy')
#set($sumSecco = 0)
#set($sumUmido = 0)
#set($oldData = '')
#foreach( $m in $obj.getRegistroDoganale(false) )
#if( ! $m.getIdStallo() )#set( $rettificaDone = false )#end
<tr#if($velocityCount%2  == 0) class="odd"#end>
<td> 
#if ( $m.NumRegistro )
$!m.NumRegistro
#else
#set($registraDOG = true)
<input type="checkbox" name="registraDOG" #if($obj.IdIter == 4) value="$m.Id" #else value="$m.Data" #end id="registraDOG_$velocityCount" />
##<label for="registraDOG_$velocityCount">Registra</label>
##<a href="?cmd=editmovimento&id=$m.Id&assegnaRegDoganale=1&exec=1">Registra</a>
#end
<a  href=".consegne?cmd=editgroup&idC=$m.Consegna.Id&data=$m.Data.ymdString()&t=$m.Tipo">[Modifica]</a>
</td>
##<td>#if($m.getIsScarico()) S#else C#end #if($m.getIsRettifica())(R)
##<a  href=".consegne?cmd=editmovimento&id=$m.Id">Modifica</a></td>
##else&nbsp;&nbsp;&nbsp;&nbsp;#end</td>
<td>$tools.Date.format($dateFormat, $m.Data)</td>

<td>&nbsp;$!m.Documento #if($!m.DocumentoPV) <br /><small>($!m.DocumentoPV)</small>#end</td>



#if($m.getIsScarico() ||  $m.Umido.intValue() < 0 )
#if( $m.Umido.intValue() < 0 )
<td>&nbsp;</td>
<td class="r">$!tools.Number.format($tools.Math.mul( -1 , $m.Umido))</td>
#else
<td>&nbsp;</td>
<td class="r">$tools.Number.format($m.Umido)</td>
#end
#else
<td class="r">$tools.Number.format($m.Umido)</td>
<td>&nbsp;</td>
#end

<td>&nbsp;</td>

#if($m.getIsScarico() ||  $m.Secco.intValue() < 0 )
#if( $m.Secco.intValue() < 0 )
<td>&nbsp;</td>
<td class="r">$!tools.Number.format($tools.Math.mul( -1 , $m.Secco))</td>
#else
<td>&nbsp;</td>
<td class="r">$tools.Number.format($m.Secco)</td>
#end
#else
<td class="r">$tools.Number.format($m.Secco)</td>
<td>&nbsp;</td>
#end

#*
#if($m.getIsScarico() || $m.Umido < 0 )
<td>&nbsp;</td>
<td class="r">$tools.Number.format($m.Umido)</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
<td class="r">$!tools.Number.format($m.Secco)</td>
#else
<td class="r">$!tools.Number.format($m.Umido)</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
<td class="r">$tools.Number.format($m.Secco)</td>
<td>&nbsp;</td>
#end
*#
##<td>$m.Stallo.Parco&nbsp;$m.Stallo.Numero</td>

#*<td>
<a #if($velocityCount%25  == 0) id="lnk$m.Id"#end href=".consegne?cmd=editmovimento&id=$m.Id">Modifica</a></td>
</tr>*#


#if( $m.getIsScarico() )
#set($sumSecco = $tools.Math.sub( $sumSecco , $m.Secco ) )
#set($sumUmido = $tools.Math.sub( $sumUmido , $m.Umido ) )
#else
#set($sumSecco = $tools.Math.add( $sumSecco , $m.Secco ) )
#set($sumUmido = $tools.Math.add( $sumUmido , $m.Umido ) )
#end

#if ( "$sumUmido" == '0.0' )
<tr class="sep"><td colspan="10" align="center">Svuotamento Stallo</td></tr>
#end

#end
<tr><td colspan="12" align="center">&nbsp;</td></tr>
<tr class="sepNoHi">
<th>
#if($registraDOG)
<input type="checkbox" onchange="selectDOG(this);" id="selAll" /> <label for="selAll">Tutti</label><br />
<input type="button" value="Registra" onclick="registraDOG();">#end
&nbsp;
</th>
<th colspan="2"><br /><b>Giacenza Attuale:</b></th>
<th colspan="2"><br /><b>$tools.Number.format($sumUmido)</b></th>
<th>&nbsp;</th>
#set( $sumSeccoCalcolato = $obj.calcolaSecco($sumUmido) )
<th colspan="2"><br /><b>$tools.Number.format($sumSecco)</b>
#if( $sumSeccoCalcolato != $sumSecco)<br><small>($tools.Number.format( $sumSeccoCalcolato ))</small>#end</th>

</tr>
</tbody></table>


<br />





<script type="text/javascript">

$('document').ready( function() {

} ) ;

function selectDOG(btn) {
	
	var list = document.getElementsByTagName('input');
	
	for( var el = 0; el < list.length ; el++ ) {
		if ( list[el].name && list[el].name == 'registraDOG' ) {
			list[el].checked = btn.checked ;
		}
	}
}
function registraDOG() {
	var list = document.getElementsByTagName('input');
	
	var ids = '' ;
	for( var el = 0; el < list.length ; el++ ) {
		if ( list[el].name && list[el].name == 'registraDOG' && list[el].checked ) {
			ids += '&list=' + list[el].value ;
		}
	}

	location.href='.registri?cmd=assegnaReg&dog=1&exec=1&c=$obj.Id' + ids ;
}
</script>